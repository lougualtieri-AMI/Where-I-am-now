<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#0f172a">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="mobile-web-app-capable" content="yes">
  <title>Where Am I?</title>
  <link rel="manifest" href="./manifest.json">
  <link rel="icon" type="image/png" sizes="192x192" href="./icon-192.png">
  <link rel="apple-touch-icon" href="./icon-192.png">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  <style>
    * { -webkit-tap-highlight-color: transparent; }
    body { 
      overscroll-behavior: none;
      -webkit-user-select: none;
      user-select: none;
    }
    .animate-spin { animation: spin 1s linear infinite; }
    @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    .slide-in { animation: slideIn 0.3s ease-out; }
    @keyframes slideIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
  </style>
</head>
<body class="bg-slate-900">
  <div id="app" class="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-white p-4"></div>

  <script>
    // ===== CONFIGURATION - EDIT THIS SECTION =====
    const LOCATION_TRIGGERS = [
      // Parking - ParkMobile locations
      { keywords: ['downtown sarasota', 'main st, sarasota', 'palm ave, sarasota', 'pineapple ave', 'lemon ave, sarasota', 'state st, sarasota', 'st armands', 'st. armands', 'saint armands', 'john ringling'], name: 'ParkMobile', icon: 'car', appScheme: 'intent://parkmobile.io/#Intent;scheme=https;package=net.sharewire.parkmobilev2;end', appStore: 'https://play.google.com/store/apps/details?id=net.sharewire.parkmobilev2', color: '#00b140', category: 'parking' },
      // Golf - Garmin Golf
      { keywords: ['golf course', 'golf club', 'country club', 'golf links', 'bobby jones golf', 'tpc', 'university park golf', 'lakewood ranch golf', 'laurel oak', 'sara bay', 'longboat key club'], name: 'Garmin Golf', icon: 'circle-dot', appScheme: 'intent://garmin.com/golf/#Intent;scheme=https;package=com.garmin.android.apps.golf;end', appStore: 'https://play.google.com/store/apps/details?id=com.garmin.android.apps.golf', color: '#007dc3', category: 'golf' },
      // Fitness
      { keywords: ['la fitness', 'lafitness'], name: 'LA Fitness', icon: 'dumbbell', appScheme: 'intent://lafitness.com/#Intent;scheme=https;package=com.lafitness.lafitness;end', appStore: 'https://play.google.com/store/apps/details?id=com.lafitness.lafitness', color: '#e53935' },
      { keywords: ['shoprite', 'shop rite'], name: 'ShopRite', icon: 'shopping-cart', appScheme: 'intent://shoprite.com/#Intent;scheme=https;package=com.shoprite.shopriteapp;end', appStore: 'https://play.google.com/store/apps/details?id=com.shoprite.shopriteapp', color: '#d32f2f' },
      { keywords: ['walmart'], name: 'Walmart', icon: 'store', appScheme: 'intent://walmart.com/#Intent;scheme=https;package=com.walmart.android;end', appStore: 'https://play.google.com/store/apps/details?id=com.walmart.android', color: '#0071ce' },
      { keywords: ['target'], name: 'Target', icon: 'store', appScheme: 'intent://target.com/#Intent;scheme=https;package=com.target.ui;end', appStore: 'https://play.google.com/store/apps/details?id=com.target.ui', color: '#cc0000' },
      { keywords: ['starbucks'], name: 'Starbucks', icon: 'coffee', appScheme: 'intent://starbucks.com/#Intent;scheme=https;package=com.starbucks.mobilecard;end', appStore: 'https://play.google.com/store/apps/details?id=com.starbucks.mobilecard', color: '#00704a' },
      { keywords: ['cvs'], name: 'CVS Pharmacy', icon: 'pill', appScheme: 'intent://cvs.com/#Intent;scheme=https;package=com.cvs.launchers.cvs;end', appStore: 'https://play.google.com/store/apps/details?id=com.cvs.launchers.cvs', color: '#cc0000' },
      { keywords: ['walgreens'], name: 'Walgreens', icon: 'pill', appScheme: 'intent://walgreens.com/#Intent;scheme=https;package=com.walgreens.android;end', appStore: 'https://play.google.com/store/apps/details?id=com.walgreens.android', color: '#e31837' },
      { keywords: ['planet fitness'], name: 'Planet Fitness', icon: 'dumbbell', appScheme: 'intent://planetfitness.com/#Intent;scheme=https;package=com.planetfitness.home;end', appStore: 'https://play.google.com/store/apps/details?id=com.planetfitness.home', color: '#512888' },
      { keywords: ['costco'], name: 'Costco', icon: 'shopping-cart', appScheme: 'intent://costco.com/#Intent;scheme=https;package=com.costco.app.android;end', appStore: 'https://play.google.com/store/apps/details?id=com.costco.app.android', color: '#e31837' },
      { keywords: ['whole foods'], name: 'Whole Foods', icon: 'shopping-cart', appScheme: 'intent://wholefoods.com/#Intent;scheme=https;package=com.amazon.wholefoods;end', appStore: 'https://play.google.com/store/apps/details?id=com.amazon.wholefoods', color: '#00674b' },
      { keywords: ['publix'], name: 'Publix', icon: 'shopping-cart', appScheme: 'intent://publix.com/#Intent;scheme=https;package=com.publix.pharmacy;end', appStore: 'https://play.google.com/store/apps/details?id=com.publix.pharmacy', color: '#3d8b40' },
      { keywords: ['home depot'], name: 'Home Depot', icon: 'building-2', appScheme: 'intent://homedepot.com/#Intent;scheme=https;package=com.thehomedepot;end', appStore: 'https://play.google.com/store/apps/details?id=com.thehomedepot', color: '#f96302' },
      { keywords: ['lowes', "lowe's"], name: "Lowe's", icon: 'building-2', appScheme: 'intent://lowes.com/#Intent;scheme=https;package=com.lowes.android;end', appStore: 'https://play.google.com/store/apps/details?id=com.lowes.android', color: '#004990' },
      { keywords: ['mcdonalds', "mcdonald's"], name: "McDonald's", icon: 'utensils', appScheme: 'intent://mcdonalds.com/#Intent;scheme=https;package=com.mcdonalds.app;end', appStore: 'https://play.google.com/store/apps/details?id=com.mcdonalds.app', color: '#FFC72C' },
      { keywords: ['chipotle'], name: 'Chipotle', icon: 'utensils', appScheme: 'intent://chipotle.com/#Intent;scheme=https;package=com.chipotle.ordering;end', appStore: 'https://play.google.com/store/apps/details?id=com.chipotle.ordering', color: '#441500' },
    ];

    const LOCAL_SUGGESTIONS = [
      { name: 'Siesta Key Beach', desc: 'World-famous white sand beach', icon: 'waves', distance: '4.2 mi' },
      { name: 'St. Armands Circle', desc: 'Upscale shopping & dining', icon: 'store', distance: '2.1 mi' },
      { name: 'Marie Selby Gardens', desc: 'Botanical gardens on the bay', icon: 'tree-pine', distance: '1.5 mi' },
      { name: 'The Ringling Museum', desc: 'Art museum & circus history', icon: 'building-2', distance: '3.8 mi' },
    ];

    const AREA_DESCRIPTION = "Sarasota is a city on Florida's Gulf Coast known for its beaches, arts scene, and cultural attractions. The area features beautiful barrier islands, world-class museums, and a vibrant downtown with excellent dining.";
    // ===== END CONFIGURATION =====

    // App State
    let state = {
      location: null,
      loading: true,
      showDetails: false,
      matchedApp: null,
      error: null
    };

    // Read aloud state
    let isSpeaking = false;

    // Stop speaking
    function stopSpeaking() {
      if ('speechSynthesis' in window) {
        window.speechSynthesis.cancel();
      }
      isSpeaking = false;
      render();
    }

    // Read aloud with system TTS
    function readAloudSystem() {
      const text = `You're in ${state.location.city}, ${state.location.state}. ${AREA_DESCRIPTION}. Nearby highlights include ${LOCAL_SUGGESTIONS.map(s => s.name).join(', ')}.`;
      
      if ('speechSynthesis' in window) {
        window.speechSynthesis.cancel();
        
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.rate = 1.0;
        utterance.pitch = 1.0;
        utterance.volume = 1.0;
        
        const voices = window.speechSynthesis.getVoices();
        const preferredVoice = voices.find(v => v.lang.startsWith('en') && v.name.includes('Google')) 
                            || voices.find(v => v.lang.startsWith('en'));
        if (preferredVoice) utterance.voice = preferredVoice;
        
        utterance.onstart = () => { isSpeaking = true; render(); };
        utterance.onend = () => { isSpeaking = false; render(); };
        utterance.onerror = () => { isSpeaking = false; render(); };
        
        window.speechSynthesis.speak(utterance);
      }
    }

    // Read aloud with Speechify app
    function readAloudSpeechify() {
      const text = `You're in ${state.location.city}, ${state.location.state}. ${AREA_DESCRIPTION}. Nearby highlights include ${LOCAL_SUGGESTIONS.map(s => s.name).join(', ')}.`;
      const encodedText = encodeURIComponent(text);
      window.location.href = `intent:#Intent;action=android.intent.action.SEND;type=text/plain;S.android.intent.extra.TEXT=${encodedText};package=com.cliffweitzman.speechify2;end`;
    }
    
    // Load voices (needed for some browsers)
    if ('speechSynthesis' in window) {
      speechSynthesis.getVoices();
      speechSynthesis.onvoiceschanged = () => speechSynthesis.getVoices();
    }

    // Get icon SVG
    function getIcon(name, className = 'w-5 h-5') {
      const icon = document.createElement('i');
      icon.setAttribute('data-lucide', name);
      icon.className = className;
      return icon.outerHTML;
    }

    // Detect matched app
    function detectApp(address) {
      const lower = address.toLowerCase();
      for (const trigger of LOCATION_TRIGGERS) {
        if (trigger.keywords.some(kw => lower.includes(kw))) {
          return trigger;
        }
      }
      return null;
    }

    // Open app with intent
    function openApp(app) {
      window.location.href = app.appScheme;
      setTimeout(() => {
        window.open(app.appStore, '_blank');
      }, 1000);
    }

    // Get current location
    function getLocation() {
      state.loading = true;
      state.error = null;
      render();

      if (!navigator.geolocation) {
        state.error = 'Geolocation not supported';
        state.loading = false;
        render();
        return;
      }

      navigator.geolocation.getCurrentPosition(
        async (position) => {
          const { latitude, longitude } = position.coords;
          try {
            // Reverse geocode using free API
            const response = await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${latitude}&lon=${longitude}&format=json`);
            const data = await response.json();
            
            state.location = {
              address: data.display_name || `${latitude.toFixed(4)}, ${longitude.toFixed(4)}`,
              city: data.address?.city || data.address?.town || data.address?.village || 'Unknown',
              state: data.address?.state || '',
              lat: latitude,
              lng: longitude
            };
            state.matchedApp = detectApp(state.location.address);
          } catch (e) {
            state.location = {
              address: `${latitude.toFixed(4)}, ${longitude.toFixed(4)}`,
              city: 'Unknown',
              state: '',
              lat: latitude,
              lng: longitude
            };
          }
          state.loading = false;
          render();
        },
        (error) => {
          // Fallback to default location
          state.location = {
            address: '540 N Tamiami Trail, Sarasota, FL 34236',
            city: 'Sarasota',
            state: 'Florida',
            lat: 27.3412,
            lng: -82.5463
          };
          state.matchedApp = detectApp(state.location.address);
          state.loading = false;
          render();
        },
        { enableHighAccuracy: true, timeout: 10000 }
      );
    }

    // Toggle details
    function toggleDetails() {
      state.showDetails = !state.showDetails;
      render();
    }

    // Get time greeting
    function getTimeInfo() {
      const now = new Date();
      const hour = now.getHours();
      const time = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
      const day = now.toLocaleDateString([], { weekday: 'long' });
      return { time, day };
    }

    // Render the app
    function render() {
      const { time, day } = getTimeInfo();
      const app = document.getElementById('app');
      
      app.innerHTML = `
        <div class="max-w-md mx-auto space-y-4">
          <!-- Header -->
          <div class="text-center pt-4 pb-2">
            <h1 class="text-2xl font-bold bg-gradient-to-r from-cyan-400 to-blue-500 bg-clip-text text-transparent">
              Where Am I?
            </h1>
            <p class="text-slate-400 text-sm mt-1">${time} â€¢ ${day}</p>
          </div>

          <!-- Location Card -->
          <div class="bg-slate-800/50 backdrop-blur rounded-2xl p-5 border border-slate-700/50">
            <div class="flex items-start gap-4">
              <div class="p-3 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-xl">
                <i data-lucide="map-pin" class="w-6 h-6"></i>
              </div>
              <div class="flex-1 min-w-0">
                ${state.loading ? `
                  <div class="h-5 bg-slate-700 rounded w-32 mb-2 animate-pulse"></div>
                  <div class="h-4 bg-slate-700 rounded w-48 animate-pulse"></div>
                ` : `
                  <h2 class="font-semibold text-lg truncate">${state.location?.city || 'Unknown'}, ${state.location?.state || ''}</h2>
                  <p class="text-slate-400 text-sm truncate">${state.location?.address || 'Getting location...'}</p>
                `}
              </div>
              <button onclick="getLocation()" class="p-2 hover:bg-slate-700 rounded-lg transition-all ${state.loading ? 'animate-spin' : ''}">
                <i data-lucide="refresh-cw" class="w-5 h-5 text-slate-400"></i>
              </button>
            </div>
          </div>

          ${state.matchedApp ? `
          <!-- Quick App Launch -->
          <div onclick="openApp(LOCATION_TRIGGERS.find(t => t.name === '${state.matchedApp.name}'))" 
               class="bg-gradient-to-r from-emerald-600/20 to-teal-600/20 border border-emerald-500/30 rounded-2xl p-4 cursor-pointer active:scale-[0.98] transition-transform">
            <div class="flex items-center gap-4">
              <div class="p-3 rounded-xl" style="background-color: ${state.matchedApp.color}">
                <i data-lucide="${state.matchedApp.icon}" class="w-6 h-6 text-white"></i>
              </div>
              <div class="flex-1">
                <p class="text-emerald-400 text-xs font-medium uppercase tracking-wide">
                  ${state.matchedApp.category === 'parking' ? 'Parking Zone' : 
                    state.matchedApp.category === 'golf' ? 'Golf Course Detected' : "You're at"}
                </p>
                <h3 class="font-semibold text-lg">${state.matchedApp.name}</h3>
                <p class="text-slate-400 text-xs">
                  ${state.matchedApp.category === 'parking' ? 'Pay for parking quickly' : 
                    state.matchedApp.category === 'golf' ? 'Track your round & get GPS distances' : 
                    'Tap to open app'}
                </p>
              </div>
              <div class="flex items-center gap-2 text-emerald-400">
                <span class="text-sm">Open</span>
                <i data-lucide="external-link" class="w-4 h-4"></i>
              </div>
            </div>
          </div>
          ` : ''}

          <!-- Discover Area Button -->
          <button onclick="toggleDetails()" 
                  class="w-full bg-gradient-to-r from-cyan-500 to-blue-600 hover:from-cyan-400 hover:to-blue-500 rounded-2xl p-5 text-left transition-all active:scale-[0.98]">
            <div class="flex items-center gap-4">
              <div class="p-3 bg-white/20 rounded-xl">
                <i data-lucide="sparkles" class="w-6 h-6"></i>
              </div>
              <div class="flex-1">
                <h3 class="font-semibold text-lg">Discover This Area</h3>
                <p class="text-cyan-100 text-sm">Things to do, places to eat & more</p>
              </div>
              <i data-lucide="chevron-right" class="w-6 h-6 transition-transform ${state.showDetails ? 'rotate-90' : ''}"></i>
            </div>
          </button>

          ${state.showDetails ? `
          <!-- Area Details -->
          <div class="space-y-4 slide-in">
            <!-- Area Overview -->
            <div class="bg-slate-800/50 backdrop-blur rounded-2xl p-5 border border-slate-700/50">
              <div class="flex items-center justify-between mb-3">
                <h3 class="font-semibold text-lg flex items-center gap-2">
                  <i data-lucide="info" class="w-5 h-5 text-cyan-400"></i>
                  About ${state.location?.city || 'This Area'}
                </h3>
              </div>
              <p class="text-slate-300 text-sm leading-relaxed">${AREA_DESCRIPTION}</p>
              <div class="flex gap-2 mt-3 flex-wrap">
                <span class="px-3 py-1 bg-cyan-500/20 text-cyan-300 rounded-full text-xs">Beaches</span>
                <span class="px-3 py-1 bg-purple-500/20 text-purple-300 rounded-full text-xs">Arts & Culture</span>
                <span class="px-3 py-1 bg-emerald-500/20 text-emerald-300 rounded-full text-xs">Dining</span>
                <span class="px-3 py-1 bg-orange-500/20 text-orange-300 rounded-full text-xs">Nature</span>
              </div>
              <!-- Read Aloud Buttons -->
              <div class="flex gap-2 mt-4">
                ${isSpeaking ? `
                <button onclick="stopSpeaking()" 
                        class="flex items-center gap-2 px-4 py-2 bg-red-500/20 hover:bg-red-500/30 text-red-400 rounded-lg transition-colors">
                  <i data-lucide="square" class="w-4 h-4"></i>
                  <span class="text-sm">Stop</span>
                </button>
                ` : `
                <button onclick="readAloudSystem()" 
                        class="flex items-center gap-2 px-4 py-2 bg-orange-500/20 hover:bg-orange-500/30 text-orange-400 rounded-lg transition-colors">
                  <i data-lucide="volume-2" class="w-4 h-4"></i>
                  <span class="text-sm">Read Aloud</span>
                </button>
                <button onclick="readAloudSpeechify()" 
                        class="flex items-center gap-2 px-4 py-2 bg-blue-500/20 hover:bg-blue-500/30 text-blue-400 rounded-lg transition-colors">
                  <i data-lucide="external-link" class="w-4 h-4"></i>
                  <span class="text-sm">Speechify</span>
                </button>
                `}
              </div>
            </div>

            <!-- Suggestions -->
            <div class="bg-slate-800/50 backdrop-blur rounded-2xl p-5 border border-slate-700/50">
              <h3 class="font-semibold text-lg mb-3 flex items-center gap-2">
                <i data-lucide="navigation" class="w-5 h-5 text-cyan-400"></i>
                Nearby Highlights
              </h3>
              <div class="space-y-3">
                ${LOCAL_SUGGESTIONS.map(place => `
                  <div class="flex items-center gap-3 p-3 bg-slate-700/30 rounded-xl">
                    <div class="p-2 bg-slate-600/50 rounded-lg">
                      <i data-lucide="${place.icon}" class="w-5 h-5 text-cyan-400"></i>
                    </div>
                    <div class="flex-1 min-w-0">
                      <h4 class="font-medium truncate">${place.name}</h4>
                      <p class="text-slate-400 text-xs truncate">${place.desc}</p>
                    </div>
                    <span class="text-slate-500 text-xs whitespace-nowrap">${place.distance}</span>
                  </div>
                `).join('')}
              </div>
            </div>

            <!-- Quick Actions -->
            <div class="grid grid-cols-2 gap-3">
              <button onclick="window.open('geo:${state.location?.lat},${state.location?.lng}')" 
                      class="bg-slate-800/50 backdrop-blur rounded-xl p-4 border border-slate-700/50 active:bg-slate-700/50 transition-colors text-left">
                <i data-lucide="map" class="w-5 h-5 text-cyan-400 mb-2"></i>
                <span class="font-medium text-sm">Open Maps</span>
              </button>
              <button onclick="window.open('geo:0,0?q=restaurants')" 
                      class="bg-slate-800/50 backdrop-blur rounded-xl p-4 border border-slate-700/50 active:bg-slate-700/50 transition-colors text-left">
                <i data-lucide="utensils" class="w-5 h-5 text-orange-400 mb-2"></i>
                <span class="font-medium text-sm">Find Food</span>
              </button>
              <button onclick="window.open('geo:0,0?q=coffee')" 
                      class="bg-slate-800/50 backdrop-blur rounded-xl p-4 border border-slate-700/50 active:bg-slate-700/50 transition-colors text-left">
                <i data-lucide="coffee" class="w-5 h-5 text-amber-400 mb-2"></i>
                <span class="font-medium text-sm">Coffee Nearby</span>
              </button>
              <button onclick="window.open('geo:0,0?q=gas+station')" 
                      class="bg-slate-800/50 backdrop-blur rounded-xl p-4 border border-slate-700/50 active:bg-slate-700/50 transition-colors text-left">
                <i data-lucide="fuel" class="w-5 h-5 text-emerald-400 mb-2"></i>
                <span class="font-medium text-sm">Gas Stations</span>
              </button>
            </div>
          </div>
          ` : ''}

          <!-- Supported Apps -->
          <div class="bg-slate-800/50 backdrop-blur rounded-2xl p-5 border border-slate-700/50">
            <h3 class="font-semibold text-sm text-slate-400 mb-3 uppercase tracking-wide">
              Supported Apps
            </h3>
            <div class="flex flex-wrap gap-2">
              ${LOCATION_TRIGGERS.slice(0, 8).map(app => `
                <div class="flex items-center gap-2 px-3 py-1.5 bg-slate-700/30 rounded-full text-xs">
                  <i data-lucide="${app.icon}" class="w-3 h-3" style="color: ${app.color}"></i>
                  <span>${app.name}</span>
                </div>
              `).join('')}
              <span class="px-3 py-1.5 text-slate-500 text-xs">+${LOCATION_TRIGGERS.length - 8} more</span>
            </div>
          </div>

          <p class="text-center text-slate-500 text-xs pb-4">
            Tap refresh to update your location
          </p>
        </div>
      `;

      // Initialize Lucide icons
      lucide.createIcons();
    }

    // Register service worker
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./sw.js')
        .then(() => console.log('Service Worker registered'))
        .catch(err => console.log('SW registration failed:', err));
    }

    // Start the app
    getLocation();
  </script>
</body>
</html>
